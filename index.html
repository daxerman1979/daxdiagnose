<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DAX DIAGNOSE PRO v10.4</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg-color: #050505; --card-bg: #111111; --primary: #00d2ff;
            --safe: #00ff88; --danger: #ff3333; --text-main: #ffffff;
        }
        body, html { margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-main); font-family: 'Roboto Mono', monospace; height: 100vh; width: 100vw; overflow: hidden; }

        header { 
            position: fixed; top: 0; width: 100%; height: 50px; background: #000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 100; border-bottom: 2px solid #222; 
        }
        .header-title { font-family: 'Orbitron'; font-size: 12px; color: var(--primary); letter-spacing: 1px; }
        #connection-status { font-size: 9px; font-weight: bold; margin-top: 2px; }

        /* INTRO SCREEN */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1); }
        .scanner-line { width: 100%; height: 2px; background: var(--primary); position: absolute; top: 0; box-shadow: 0 0 15px var(--primary); animation: scan 3s infinite; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        #terminal-out { width: 80%; height: 120px; font-size: 10px; color: #555; overflow: hidden; margin-bottom: 20px; text-transform: uppercase; }
        
        .loader-container { width: 70%; height: 4px; background: #111; margin: 20px 0; border-radius: 2px; overflow: hidden; border: 1px solid #222; }
        .loader-bar { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s linear; }
        
        .btn-main { padding: 18px 40px; border-radius: 4px; background: none; color: var(--primary); font-family: 'Orbitron'; border: 2px solid var(--primary); font-weight: bold; cursor: pointer; font-size: 12px; letter-spacing: 2px; transition: 0.3s; }
        .btn-main:active { background: var(--primary); color: #000; }

        /* DASHBOARD */
        .page { display: none; position: absolute; top: 50px; bottom: 70px; width: 100%; padding: 12px; flex-direction: column; overflow-y: auto; }
        .page.active { display: flex; }
        .card { background: var(--card-bg); border-radius: 4px; border: 1px solid #222; padding: 15px; margin-bottom: 10px; }
        .main-val { font-family: 'Orbitron'; font-size: 44px; text-align: center; margin: 5px 0; font-weight: 700; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card-label { font-size: 9px; color: #666; font-weight: bold; border-bottom: 1px solid #222; padding-bottom: 4px; margin-bottom: 8px; }
        .card-val { font-family: 'Orbitron'; font-size: 22px; text-align: center; margin: 4px 0; }
        .bar-bg { width: 100%; height: 4px; background: #111; margin-top: 10px; border-radius: 2px; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.5s; }

        /* NAV */
        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #000; display: flex; border-top: 2px solid #222; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #444; font-weight: bold; font-family: 'Orbitron'; }
        .nav-item.active { color: var(--primary); border-top: 3px solid var(--primary); }

        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; z-index: 6000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #0a0a0a; width: 100%; max-width: 400px; border: 1px solid var(--primary); padding: 30px; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="scanner-line"></div>
        <div id="terminal-out"></div>
        <div class="loader-container"><div id="loader-bar" class="loader-bar"></div></div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-main" id="btn-connect" style="display:none;" onclick="requestBluetooth()">CONNECT ADAPTER</button>
            <button class="btn-main" id="btn-demo" style="display:none; border-color: #444; color: #444;" onclick="startMode('SIMULATION')">DEMO</button>
        </div>
    </div>

    <header>
        <div class="header-title">DAX DIAGNOSE v10.4</div>
        <div id="connection-status" style="color: #ff3333;">MOD: DISCONNECTED</div>
    </header>

    <div id="page-podaci" class="page active">
        <div class="card" onclick="showInfo('AKUMULATOR')">
            <div class="card-label">BATT_VOLTAGE (PID 42)</div>
            <div id="aku-val" class="main-val">--.- V</div>
            <div class="bar-bg"><div id="aku-bar" class="bar-fill"></div></div>
        </div>
        <div class="grid" id="sensor-grid">
            </div>
    </div>

    <nav>
        <div class="nav-item active">PODACI</div>
        <div class="nav-item" onclick="alert('Povežite adapter za pristup ECU memoriji')">GREŠKE</div>
    </nav>

    <div id="modal" onclick="this.style.display='none'">
        <div class="modal-content">
            <h2 id="m-title" style="color:var(--primary); font-family:Orbitron; font-size:18px;"></h2>
            <p id="m-desc" style="color:#888; font-size:13px; line-height:1.6;"></p>
        </div>
    </div>

    <script>
        const terminal = document.getElementById('terminal-out');
        const logs = [
            "> Initializing protocols...", "> Searching for OBDII on CAN...", "> ISO 15765-4 (CAN 11/500) detected", 
            "> ECU handshaking...", "> VIN: WA1ZZZ8KXXXXXXXX", "> Dax Diagnose Pro v10.4 Ready"
        ];

        let logIdx = 0;
        const logInt = setInterval(() => {
            if(logIdx < logs.length) {
                terminal.innerHTML += logs[logIdx] + "<br>";
                logIdx++;
            }
        }, 600);

        let loadP = 0;
        const loader = setInterval(() => {
            loadP += 2;
            document.getElementById('loader-bar').style.width = loadP + "%";
            if(loadP >= 100) {
                clearInterval(loader);
                document.getElementById('btn-connect').style.display = "block";
                document.getElementById('btn-demo').style.display = "block";
            }
        }, 50);

        async function requestBluetooth() {
            try {
                // OVO OTVARA PROZOR SA LISTOM SVIH TVOJIH BLUETOOTH UREĐAJA
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'OBD' }, { namePrefix: 'V-LINK' }, { namePrefix: 'ELM' }],
                    optionalServices: ['00001101-0000-1000-8000-00805f9b34fb']
                });
                
                startMode('LIVE - ' + device.name);
            } catch (e) {
                alert("Niste izabrali uređaj. Možete koristiti DEMO mod.");
            }
        }

        function startMode(mode) {
            const status = document.getElementById('connection-status');
            status.innerText = "MOD: " + mode;
            status.style.color = mode.includes('LIVE') ? "#00ff88" : "#ffcc00";
            
            document.getElementById('splash').style.transform = "translateY(-100%)";
            
            // Pokretanje vizuelizacije podataka
            initGrid();
            setInterval(() => updateData(mode.includes('LIVE')), 1000);
        }

        function initGrid() {
            const sensors = [
                {id:'dpf', label:'DPF_LOAD'}, {id:'ant', label:'COOLANT_TEMP'},
                {id:'rpm', label:'ENGINE_RPM'}, {id:'brz', label:'VEHICLE_SPEED'},
                {id:'load', label:'CALC_LOAD'}, {id:'iat', label:'INTAKE_TEMP'},
                {id:'egr', label:'EGR_SYSTEM'}, {id:'pri', label:'DIFF_PRESSURE'}
            ];
            const grid = document.getElementById('sensor-grid');
            grid.innerHTML = sensors.map(s => `
                <div class="card" onclick="showInfo('${s.label}')">
                    <div class="card-label">${s.label}</div>
                    <div id="${s.id}-val" class="card-val">--</div>
                    <div class="bar-bg"><div id="${s.id}-bar" class="bar-fill"></div></div>
                </div>
            `).join('');
        }

        function updateData(isLive) {
            // Ako je LIVE, ovde bi išao fetch sa adaptera. Za sada vizuelno punimo.
            const data = {
                aku: (Math.random() * 2.5 + 12.1).toFixed(1),
                dpf: Math.floor(Math.random() * 100),
                ant: Math.floor(Math.random() * 30 + 75),
                rpm: Math.floor(Math.random() * 2000 + 800),
                brz: Math.floor(Math.random() * 140),
                load: Math.floor(Math.random() * 100),
                iat: Math.floor(Math.random() * 40),
                egr: Math.floor(Math.random() * 400 + 100),
                pri: Math.floor(Math.random() * 50)
            };

            Object.keys(data).forEach(key => {
                const vEl = document.getElementById(key + '-val');
                const bEl = document.getElementById(key + '-bar');
                if(vEl) vEl.innerText = data[key] + getUnit(key);
                if(bEl) bEl.style.width = Math.min(data[key] / (key=='rpm'?50:1), 100) + "%";
                if(bEl) bEl.style.backgroundColor = (key=='aku' && data[key]<12.5) ? 'var(--danger)' : 'var(--safe)';
            });
        }

        function getUnit(k) {
            return k=='aku'?' V':(k=='ant' || k=='iat' || k=='egr'?'°C':(k=='brz'?' km/h':(k=='pri'?' hPa':'%')));
        }

        function showInfo(t) {
            document.getElementById('m-title').innerText = t;
            document.getElementById('m-desc').innerText = "Očitavanje parametra " + t + " u realnom vremenu preko CAN-BUS protokola. Proverite servisnu knjižicu za tolerancije.";
            document.getElementById('modal').style.display = 'flex';
        }
    </script>
</body>
</html>
