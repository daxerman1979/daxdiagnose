<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DAX PRO v23</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --bg: #000; --accent: #00d2ff; --safe: #00ff88; --danger: #ff1111; }
        
        body, html { 
            margin: 0; padding: 0; background: var(--bg); color: #fff; 
            font-family: 'Roboto', sans-serif; height: 100vh; overflow: hidden; 
        }

        /* POČETNI EKRAN */
        #splash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 5000; 
            transition: 0.6s ease; 
        }
        .splash-logo { font-family: 'Orbitron'; font-size: 35px; font-weight: 900; margin-bottom: 50px; letter-spacing: 5px; }
        
        .btn-main { 
            width: 85%; padding: 25px; margin: 10px; border-radius: 15px; 
            font-family: 'Orbitron'; font-weight: 900; font-size: 16px; 
            cursor: pointer; transition: 0.3s; text-transform: uppercase;
        }
        .btn-connect { background: var(--accent); color: #000; border: none; }
        .btn-sim { background: transparent; color: #fff; border: 2px solid #fff; }

        header { 
            height: 70px; border-bottom: 2px solid #222; display: flex; 
            align-items: center; justify-content: center; background: #000;
            position: fixed; top: 0; width: 100%; z-index: 100;
        }
        .header-title { font-family: 'Orbitron'; font-size: 18px; font-weight: 900; color: #fff; letter-spacing: 2px; }

        #view-slider { display: flex; width: 200vw; height: 100vh; transition: transform 0.4s ease; }
        
        /* POVEĆAN PADDING-TOP DA NE PREKRIVA KARTICE */
        .page { width: 100vw; height: 100vh; padding: 100px 15px 80px; flex-shrink: 0; overflow-y: auto; }

        /* KARTICE SENZORA */
        .card { 
            background: #0c0c0c; border: 2px solid #222; border-radius: 20px; 
            padding: 25px; margin-bottom: 15px; display: flex; 
            justify-content: space-between; align-items: center;
        }
        .card-label { 
            font-size: 16px; color: #fff; font-weight: 900; 
            text-transform: uppercase; letter-spacing: 1px; 
        }
        .card-val { 
            font-family: 'Orbitron'; font-size: 50px; font-weight: 900; color: #fff; 
        }
        .card-unit { 
            font-size: 16px; color: #fff; font-family: 'Orbitron'; font-weight: 900; margin-left: 8px;
        }

        .card.danger { border-color: var(--danger); background: #1a0000; }
        .card.danger .card-val { color: var(--danger); text-shadow: 0 0 20px var(--danger); }
        .card.safe { border-left: 8px solid var(--safe); }

        /* DIJAGNOSTIKA - SKROLOVANJE SAMO ZA GREŠKE */
        .diag-container { display: flex; flex-direction: column; height: 100%; }
        
        .diag-box { 
            flex-grow: 1; border: 3px solid #222; border-radius: 20px; 
            padding: 15px; overflow-y: scroll; /* Omogućeno skrolovanje unutar kutije */
            background: #050505;
        }
        
        .err-item { 
            background: #200; border: 1px solid red; padding: 15px; 
            border-radius: 12px; margin-bottom: 10px; 
        }
        .err-code { font-family: 'Orbitron'; font-size: 20px; font-weight: 900; color: red; }
        .err-desc { color: #fff; font-weight: 900; font-size: 13px; margin-top: 3px; text-transform: uppercase; }

        .nav-dots { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
            display: flex; gap: 20px; 
        }
        .dot { width: 12px; height: 12px; background: #333; border-radius: 50%; }
        .dot.active { background: #fff; transform: scale(1.5); box-shadow: 0 0 10px #fff; }

    </style>
</head>
<body ontouchstart="hTS(event)" ontouchmove="hTM(event)">

    <div id="splash">
        <div class="splash-logo">DAX PRO</div>
        <button class="btn-main btn-connect" onclick="connectAdapter()">Poveži Adapter</button>
        <button class="btn-main btn-sim" onclick="startSim()">Simulacija</button>
    </div>

    <header><div class="header-title" id="h-title">LIVE DATA</div></header>

    <div id="view-slider">
        <div class="page" id="page-list">
            <div id="main-list"></div>
        </div>

        <div class="page">
            <div class="diag-container">
                <div class="diag-box" id="diag-out">
                    <p style="text-align:center; color:#444; font-family:Orbitron; font-weight:900; margin-top:100px;">ČEKAM SKENIRANJE</p>
                </div>
                <button class="btn-main btn-connect" id="diag-btn" onclick="runDiagnostic()" style="margin-top:15px; width:100%;">SKENIRAJ VOZILO</button>
            </div>
        </div>
    </div>

    <div class="nav-dots">
        <div id="d1" class="dot active"></div>
        <div id="d2" class="dot"></div>
    </div>

    <script>
        let tsX = 0, activePage = 0;

        function hTS(e) { tsX = e.touches[0].clientX; }
        function hTM(e) {
            let diff = tsX - e.touches[0].clientX;
            if (Math.abs(diff) > 100) {
                activePage = diff > 0 ? 1 : 0;
                document.getElementById('view-slider').style.transform = `translateX(-${activePage * 100}vw)`;
                document.getElementById('d1').className = activePage == 0 ? 'dot active' : 'dot';
                document.getElementById('d2').className = activePage == 1 ? 'dot active' : 'dot';
                document.getElementById('h-title').innerText = activePage == 0 ? "LIVE DATA" : "DIAGNOSTIKA";
            }
        }

        const sensors = [
            { id: 'aku', label: 'Akumulator', unit: 'V', min: 13.0, max: 14.8 },
            { id: 'rpm', label: 'Obrtaji', unit: 'RPM', min: 0, max: 4000 },
            { id: 'ant', label: 'Temperatura', unit: '°C', min: 80, max: 100 },
            { id: 'dpf', label: 'DPF Filter', unit: '%', min: 0, max: 70 },
            { id: 'brz', label: 'Brzina', unit: 'KMH', min: 0, max: 200 }
        ];

        // LISTA OD 10 GREŠAKA
        const errorList = [
            { code: "P0420", desc: "Efikasnost katalizatora ispod praga" },
            { code: "P0101", desc: "MAF Senzor - problem sa opsegom" },
            { code: "P0300", desc: "Nasumično izostajanje paljenja" },
            { code: "P0171", desc: "Smeša previše siromašna (Bank 1)" },
            { code: "P0401", desc: "EGR ventil - nedovoljan protok" },
            { code: "P0113", desc: "IAT Senzor - visok ulazni napon" },
            { code: "P0500", desc: "Senzor brzine vozila - kvar" },
            { code: "P0234", desc: "Turbo punjač - prepunjavanje" },
            { code: "P0606", desc: "Greška u procesoru ECU modula" },
            { code: "P0135", desc: "Grejač lambda sonde - kvar" }
        ];

        function init() {
            document.getElementById('main-list').innerHTML = sensors.map(s => `
                <div id="card-${s.id}" class="card safe">
                    <div class="card-label"><b>${s.label}</b></div>
                    <div style="display:flex; align-items:baseline;">
                        <span id="${s.id}-v" class="card-val">0</span>
                        <span class="card-unit"><b>${s.unit}</b></span>
                    </div>
                </div>
            `).join('');
        }

        function startSim() {
            document.getElementById('splash').style.transform = "translateY(-100%)";
            setInterval(updateData, 1000);
        }

        async function connectAdapter() {
            try {
                await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'OBD' }],
                    optionalServices: ['00001101-0000-1000-8000-00805f9b34fb']
                });
                document.getElementById('splash').style.transform = "translateY(-100%)";
                setInterval(updateData, 1000);
            } catch (e) { startSim(); }
        }

        function updateData() {
            sensors.forEach(s => {
                let v = (s.id === 'aku') ? (Math.random() * 1 + 13.5).toFixed(1) : Math.floor(Math.random() * s.max);
                document.getElementById(s.id + '-v').innerText = v;
                let safe = v >= s.min && v <= s.max;
                if(s.id === 'brz' || s.id === 'rpm') safe = true;
                document.getElementById('card-' + s.id).className = 'card ' + (safe ? 'safe' : 'danger');
            });
        }

        function runDiagnostic() {
            const out = document.getElementById('diag-out');
            const btn = document.getElementById('diag-btn');
            
            if(btn.innerText.includes("SKENIRAJ")) {
                out.innerHTML = "<p style='text-align:center; color:var(--accent); font-family:Orbitron; font-weight:900; margin-top:50px;'>SKENIRANJE U TOKU...</p>";
                setTimeout(() => {
                    out.innerHTML = errorList.map(e => `
                        <div class="err-item">
                            <div class="err-code">${e.code}</div>
                            <div class="err-desc">${e.desc}</div>
                        </div>
                    `).join('');
                    btn.innerText = "OBRIŠI GREŠKE";
                    btn.style.background = "red";
                }, 1500);
            } else {
                out.innerHTML = "<p style='text-align:center; color:var(--safe); font-family:Orbitron; font-weight:900; margin-top:100px;'>SISTEM ISPRAVAN</p>";
                btn.innerText = "SKENIRAJ VOZILO";
                btn.style.background = "var(--accent)";
            }
        }

        init();
    </script>
</body>
</html>
